<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vi Chất Cho Mẹ và Bé - Não bộ & Thị lực</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="So sánh sản phẩm DHA, Omega-3 cho phát triển não bộ và thị lực trẻ em tại Việt Nam. Tìm sản phẩm phù hợp với bộ lọc thông minh.">
    <meta name="keywords" content="DHA, Omega-3, não bộ trẻ em, thị lực, phát triển trí thông minh, vitamin cho não bộ">
    
    <!-- Import Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #6366f1 0%, #3b82f6 25%, #1d4ed8 50%, #1e40af 75%, #3730a3 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-glass {
            background-color: rgba(59, 130, 246, 0.8);
            backdrop-filter: blur(10px);
        }

        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-hover:hover .flip-card-front {
             box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }
        
        /* Dropdown menu styles */
        .dropdown-menu {
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .dropdown:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        /* Product card selected state */
        .product-card.selected .flip-card-front {
            border: 2px solid #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Style cho accordion filter */
        details > summary {
            cursor: pointer;
            font-weight: 600;
            color: #f3f4f6; /* text-gray-100 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        details > summary::after {
            content: '›';
            transform: rotate(90deg);
            transition: transform 0.2s;
            font-size: 1.5em;
        }
        details[open] > summary::after {
            transform: rotate(-90deg);
        }

        /* --- FLIP CARD STYLES --- */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 520px; /* Fixed height for consistency */
            perspective: 1000px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s;
            transform-style: preserve-3d;
        }
        .flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1.5rem; /* rounded-3xl */
        }
        .flip-card-back {
            transform: rotateY(180deg);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .flip-card-back h4 {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #BBDEFB;
        }
        .flip-card-back ul {
            list-style-type: none;
            padding-left: 0;
            font-size: 0.9rem;
            color: white;
            opacity: 0.9;
            flex-grow: 1;
        }
        .flip-card-back ul li {
            padding-left: 1.25rem;
            position: relative;
            margin-bottom: 0.5rem;
        }
        .flip-card-back ul li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #34D399; /* emerald-400 */
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header with Glass Effect -->
    <header class="header-glass sticky top-0 z-40 border-b border-white/20">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h1 class="text-xl md:text-2xl font-bold text-white">
                        Vi Chất Cho Mẹ và Bé
                    </h1>
                </div>
                <nav class="hidden md:flex space-x-6 text-white/80 font-medium items-center">
                    <a href="index.html" class="hover:text-white transition-colors">Trang chủ</a>
                    
                    <!-- Dropdown Menu for Products -->
                    <div class="relative dropdown">
                        <button class="hover:text-white transition-colors flex items-center space-x-1">
                            <span>Sản phẩm</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="dropdown-menu absolute top-full left-0 mt-2 w-64 rounded-xl bg-gray-900/95 backdrop-blur-lg border border-white/20 text-white p-3 shadow-xl z-50">
                            <a href="xuong-rang.html" class="block px-4 py-3 text-sm hover:bg-white/20 rounded-lg transition-colors">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-amber-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-amber-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-medium">Xương & Răng</div>
                                        <div class="text-xs text-white/60">Vitamin D3, K2, Canxi</div>
                                    </div>
                                </div>
                            </a>
                            <a href="nao-bo.html" class="block px-4 py-3 text-sm hover:bg-white/20 rounded-lg transition-colors bg-blue-500/20">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-medium">Não bộ & Thị lực</div>
                                        <div class="text-xs text-white/60">DHA, Omega-3</div>
                                    </div>
                                </div>
                            </a>
                            <a href="de-khang.html" class="block px-4 py-3 text-sm hover:bg-white/20 rounded-lg transition-colors">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-rose-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-rose-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-medium">Đề kháng & Tiêu hóa</div>
                                        <div class="text-xs text-white/60">Vitamin C, Kẽm, Probiotics</div>
                                    </div>
                                </div>
                            </a>
                            <a href="me-va-be.html" class="block px-4 py-3 text-sm hover:bg-white/20 rounded-lg transition-colors">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-medium">Phụ nữ & Thai kỳ</div>
                                        <div class="text-xs text-white/60">Sắt, Axit Folic</div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                    
                    <a href="expert.html" class="hover:text-white transition-colors">Chuyên gia</a>
                    
                    <div class="relative" id="compare-menu-container">
                        <button id="compare-btn" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl hover:shadow-lg transition-all duration-300 flex items-center space-x-2 opacity-50" disabled>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <span>So sánh (<span id="compare-count">0</span>)</span>
                        </button>
                        <div id="compare-dropdown" class="hidden absolute top-full mt-2 w-56 rounded-xl bg-gray-900/95 backdrop-blur-lg border border-white/20 text-white p-2 z-50">
                            <a href="#" data-compare-type="dosage" class="block px-4 py-2 text-sm hover:bg-white/20 rounded-lg">So sánh liều dùng</a>
                            <a href="#" data-compare-type="cost" class="block px-4 py-2 text-sm hover:bg-white/20 rounded-lg">So sánh chi phí/ngày</a>
                            <a href="#" data-compare-type="dha" class="block px-4 py-2 text-sm hover:bg-white/20 rounded-lg">So sánh hàm lượng DHA</a>
                        </div>
                    </div>
                </nav>
                <button class="md:hidden text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="relative py-16 overflow-hidden">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight">
                🧠 Sản phẩm Hỗ trợ Phát triển Não bộ & Thị lực
            </h2>
            <p class="text-lg md:text-xl text-white/80 max-w-3xl mx-auto mb-8 leading-relaxed">
                So sánh các sản phẩm DHA, Omega-3 tốt nhất cho sự phát triển trí tuệ và thị lực của trẻ.
            </p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container mx-auto p-4 md:p-8 mt-8">
        
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Enhanced Filter Sidebar -->
            <aside class="w-full lg:w-1/4">
                <div class="glass-effect p-6 rounded-3xl sticky top-24 fade-in">
                    <h3 class="font-bold text-2xl mb-6 text-white flex items-center">
                        <svg class="w-6 h-6 mr-3 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        Bộ Lọc Thông Minh
                    </h3>

                    <!-- Search -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="Tìm kiếm sản phẩm..." 
                                   class="w-full px-4 py-3 pl-12 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>

                    <!-- Sort -->
                    <div class="mb-6">
                        <select id="sort-select" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="name">Sắp xếp theo tên</option>
                            <option value="price_low">Giá thấp đến cao</option>
                            <option value="price_high">Giá cao đến thấp</option>
                            <option value="rating">Đánh giá cao nhất</option>
                        </select>
                    </div>

                    <!-- Clear Filters Button -->
                    <button id="clear-filters" class="w-full mt-4 px-4 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-300">
                        Xóa Bộ Lọc
                    </button>
                </div>
            </aside>

            <!-- Products Grid -->
            <main class="w-full lg:w-3/4">
                <div class="text-center mb-8">
                    <div id="product-count" class="text-white/80 text-lg"></div>
                </div>

                <!-- Products Grid -->
                <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Products will be inserted here by JavaScript -->
                </div>

                <!-- No Results -->
                <div id="no-results" class="hidden text-center py-16">
                    <div class="glass-effect p-12 rounded-3xl">
                        <svg class="mx-auto h-16 w-16 text-white/60 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <h3 class="text-2xl font-bold text-white mb-2">Không tìm thấy sản phẩm</h3>
                        <p class="text-white/70">Vui lòng thử lại với bộ lọc khác hoặc từ khóa tìm kiếm khác.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification glass-effect p-4 rounded-xl text-white">
        <div class="flex items-center space-x-3">
            <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span id="notification-text">Đã thêm vào danh sách so sánh</span>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const app = {
                // Affiliate URL mapping system for monetization
                affiliateUrls: {
                    // Format: productId: 'affiliate_url'
                    101: 'https://nordicnaturals.vn/?affiliate=example', // Nordic Naturals Baby's DHA
                    108: 'https://bioamicus.vn/bioamicus-dha?affiliate=example', // BioAmicus DHA
                    // Add more affiliate URLs as needed
                },

                // Get affiliate URL for a product (falls back to product_url if no affiliate URL)
                getAffiliateUrl: function(productId, fallbackUrl) {
                    return this.affiliateUrls[productId] || fallbackUrl;
                },

                products: [
                    {
                        id: 101,
                        category: 'nao_bo',
                        name: 'Nordic Naturals Baby\'s DHA',
                        brand: 'Nordic Naturals',
                        image: 'https://placehold.co/300x300/3b82f6/white?text=Nordic+Baby+DHA',
                        price: 520000,
                        volume_ml: 60,
                        total_doses_per_bottle: 120,
                        origin: {country: 'Mỹ', continent: 'Châu Mỹ'},
                        form: 'drops',
                        declared_dose: { unit_count: 1, unit_name: 'ml', dha_mg: 37, epa_mg: 60, omega3_total: 480 },
                        dosage_recommendation: { 'duoi_1_tuoi': { min: 0.5, max: 1, unit: 'ml' }, 'tu_1_den_3_tuoi': { min: 1, max: 1.5, unit: 'ml' }, 'tu_3_den_12_tuoi': { min: 1.5, max: 2, unit: 'ml' } },
                        ingredients_details: { omega3_source: 'Cá biển', purity: 'Molecular distillation', flavor: 'Strawberry' },
                        rating: 4.8,
                        reviews: 234,
                        product_url: 'https://nordicnaturals.vn/',
                        summary: {
                            benefits: [
                                'Hỗ trợ phát triển não bộ và thị lực của trẻ sơ sinh và trẻ nhỏ.',
                                'Cải thiện khả năng học tập và ghi nhớ.',
                                'Tăng cường hệ miễn dịch tự nhiên.'
                            ],
                            ingredients: [
                                'DHA từ cá biển 37mg/ml',
                                'EPA 60mg/ml',
                                'Omega-3 tổng 480mg/ml',
                                'Hương dâu tự nhiên'
                            ],
                            users: 'Trẻ sơ sinh từ 6 tháng, trẻ nhỏ và phụ nữ mang thai.'
                        }
                    },
                    {
                        id: 108,
                        category: 'nao_bo', 
                        name: 'BioAmicus DHA', 
                        brand: 'BioAmicus', 
                        image: 'https://placehold.co/300x300/3b82f6/white?text=BioAmicus+DHA',
                        price: 385000,
                        volume_ml: 30,
                        total_doses_per_bottle: 60,
                        origin: {country: 'Canada', continent: 'Châu Mỹ'}, 
                        form: 'drops',
                        declared_dose: {
                            unit_count: 1, 
                            unit_name: 'liều (0.5ml)', 
                            dha_mg: 100,
                            epa_mg: 20,
                            omega3_total: 140
                        },
                        dosage_recommendation: {
                            'duoi_1_tuoi': { min: 1, max: 1, unit: 'liều' },
                            'tu_1_den_3_tuoi': { min: 2, max: 2, unit: 'liều' },
                            'tu_3_den_12_tuoi': { min: 3, max: 3, unit: 'liều' }
                        },
                        ingredients_details: { 
                            omega3_source: 'Dầu cá tinh khiết', 
                            purity: 'Pharmaceutical grade',
                            flavor: 'Tự nhiên' 
                        },
                        rating: 4.7,
                        reviews: 156,
                        product_url: 'https://bioamicus.vn/bioamicus-dha',
                        summary: {
                            benefits: [
                                'Bổ sung 100mg DHA và 20mg EPA mỗi liều 0.5ml',
                                'Hỗ trợ phát triển não bộ và thị lực trẻ em',
                                'Từ dầu cá tinh khiết, an toàn cho trẻ sơ sinh',
                                'Liều dùng rõ ràng theo từng độ tuổi'
                            ],
                            ingredients: [
                                'DHA (Docosahexaenoic Acid) 100mg/0.5ml',
                                'EPA (Eicosapentaenoic Acid) 20mg/0.5ml', 
                                'Omega-3 tổng: 140mg/0.5ml',
                                'Dầu cá tinh khiết'
                            ],
                            users: 'Trẻ sơ sinh từ 0-12 tháng (1 liều/ngày), trẻ em 1-6 tuổi (2 liều/ngày), trẻ 7-11 tuổi (3 liều/ngày)'
                        }
                    }
                ],

                selectedProducts: [],
                
                init: function() {
                    this.renderProducts(this.products.filter(p => p.category === 'nao_bo'));
                    this.setupEventListeners();
                    this.updateProductCount(this.products.filter(p => p.category === 'nao_bo').length);
                },

                setupEventListeners: function() {
                    document.getElementById('search-input').addEventListener('input', () => this.applyFilters());
                    document.getElementById('sort-select').addEventListener('change', () => this.applyFilters());
                    document.getElementById('clear-filters').addEventListener('click', () => this.clearAllFilters());
                    
                    const productGrid = document.getElementById('product-grid');
                    if(productGrid){
                         productGrid.addEventListener('click', (e) => {
                            const flipTrigger = e.target.closest('.flip-trigger');
                            if (flipTrigger) {
                                const card = flipTrigger.closest('.flip-card');
                                if (card) card.classList.toggle('is-flipped');
                            }
                            const flipTriggerBack = e.target.closest('.flip-trigger-back');
                             if (flipTriggerBack) {
                                const card = flipTriggerBack.closest('.flip-card');
                                if (card) card.classList.toggle('is-flipped');
                            }
                            const toggleButton = e.target.closest('.toggle-compare-btn');
                            if (toggleButton) {
                                const productId = parseInt(toggleButton.dataset.productId, 10);
                                this.toggleProductSelection(productId);
                            }
                        });
                    }
                },
                
                applyFilters: function() {
                    let filtered = this.products.filter(p => p.category === 'nao_bo');
                    
                    const searchTerm = document.getElementById('search-input').value.toLowerCase();
                    if (searchTerm) {
                        filtered = filtered.filter(product => 
                            product.name.toLowerCase().includes(searchTerm) ||
                            product.brand.toLowerCase().includes(searchTerm) ||
                            product.origin.country.toLowerCase().includes(searchTerm)
                        );
                    }
                    
                    const sortBy = document.getElementById('sort-select').value;
                    filtered.sort((a, b) => {
                        switch(sortBy) {
                            case 'name': return a.name.localeCompare(b.name);
                            case 'price_low': return a.price - b.price;
                            case 'price_high': return b.price - a.price;
                            case 'rating': return b.rating - a.rating;
                            default: return 0;
                        }
                    });

                    this.renderProducts(filtered);
                    this.updateProductCount(filtered.length);
                },

                clearAllFilters: function() {
                    document.getElementById('search-input').value = '';
                    document.getElementById('sort-select').value = 'name';
                    this.applyFilters();
                },

                updateProductCount: function(count) {
                    document.getElementById('product-count').textContent = `Tìm thấy ${count} sản phẩm`;
                },

                toggleProductSelection: function(productId) {
                    const index = this.selectedProducts.indexOf(productId);
                    if (index > -1) {
                        this.selectedProducts.splice(index, 1);
                        this.showNotification('Đã xóa khỏi danh sách so sánh');
                    } else {
                        if (this.selectedProducts.length >= 4) {
                            this.showNotification('Chỉ có thể so sánh tối đa 4 sản phẩm', 'warning');
                            return;
                        }
                        this.selectedProducts.push(productId);
                        this.showNotification('Đã thêm vào danh sách so sánh');
                    }
                },
                
                formatPrice: function(price) {
                    return price.toLocaleString('vi-VN');
                },

                showNotification: function(message, type = 'success') {
                    const notification = document.getElementById('notification');
                    const notificationText = document.getElementById('notification-text');
                    
                    notificationText.textContent = message;
                    notification.classList.add('show');
                    
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 3000);
                },
                
                renderProducts: function(productsToRender) {
                    const grid = document.getElementById('product-grid');
                    const noResults = document.getElementById('no-results');
                    
                    if (!grid || !noResults) return;

                    if (productsToRender.length === 0) {
                        grid.innerHTML = '';
                        noResults.classList.remove('hidden');
                        return;
                    }
                    
                    noResults.classList.add('hidden');
                    
                    grid.innerHTML = productsToRender.map(product => {
                        const doseInfo = product.dosage_recommendation.duoi_1_tuoi || product.dosage_recommendation.tu_1_den_3_tuoi;
                        const dailyDose = doseInfo ? doseInfo.min : 1;
                        const dailyCost = Math.round((product.price / product.total_doses_per_bottle) * dailyDose);

                        const summaryHtml = product.summary ? `
                            <h4>Công dụng chính</h4>
                            <ul>${product.summary.benefits.map(b => `<li>${b}</li>`).join('')}</ul>
                            <h4 class="mt-4">Thành phần nổi bật</h4>
                            <ul>${product.summary.ingredients.map(i => `<li>${i}</li>`).join('')}</ul>
                             <h4 class="mt-4">Đối tượng sử dụng</h4>
                            <p class="text-sm opacity-90">${product.summary.users}</p>
                        ` : '<p class="text-white/70">Chưa có thông tin chi tiết.</p>';

                        return `
                        <div class="product-card" data-product-id="${product.id}">
                             <div class="flip-card card-hover">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front glass-effect p-6 rounded-3xl flex flex-col">
                                        <div class="relative mb-4">
                                            <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-2xl">
                                            <div class="absolute top-3 right-3">
                                                <span class="px-3 py-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xs font-semibold rounded-full">
                                                    ${product.origin.country}
                                                </span>
                                            </div>
                                            ${product.declared_dose.dha_mg > 0 ? 
                                                '<div class="absolute top-3 left-3"><span class="px-2 py-1 bg-cyan-500 text-white text-xs font-semibold rounded-full">DHA</span></div>' : 
                                                ''
                                            }
                                            <button class="absolute bottom-3 right-3 w-8 h-8 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-white/30 transition-colors toggle-compare-btn" data-product-id="${product.id}">
                                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                                </svg>
                                            </button>
                                        </div>
                                        
                                        <h3 class="font-bold text-lg text-white mb-2 line-clamp-2 h-14 cursor-pointer flip-trigger">${product.name}</h3>
                                        <p class="text-white/70 text-sm mb-3">${product.brand}</p>
                                        
                                        <div class="space-y-2 mb-4 border-t border-b border-white/10 py-3">
                                            <div class="flex justify-between text-sm">
                                                <span class="text-white/70">Tổng liều:</span>
                                                <span class="text-white font-medium">${product.total_doses_per_bottle} ${product.declared_dose.unit_name}</span>
                                            </div>
                                            <div class="flex justify-between text-sm">
                                                <span class="text-white/70">DHA:</span>
                                                <span class="text-white font-medium">${product.declared_dose.dha_mg} mg / ${product.declared_dose.unit_count} ${product.declared_dose.unit_name}</span>
                                            </div>
                                            <div class="flex justify-between text-sm">
                                                <span class="text-white/70">Omega-3:</span>
                                                <span class="text-white font-medium">${product.declared_dose.omega3_total} mg / ${product.declared_dose.unit_count} ${product.declared_dose.unit_name}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-auto">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <span class="text-2xl font-bold text-white">${this.formatPrice(product.price)}</span>
                                                    <span class="text-white/70 text-sm">đ</span>
                                                </div>
                                                <div class="text-right">
                                                    <span class="font-bold text-blue-400">${this.formatPrice(dailyCost)}đ</span>
                                                    <span class="text-xs text-white/70 block">/ ngày</span>
                                                </div>
                                            </div>
                                            <div class="flex gap-2 mt-3">
                                                <a href="${this.getAffiliateUrl(product.id, product.product_url)}" target="_blank" class="flex-1 block text-center px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-300 text-sm">
                                                    💰 Mua ngay
                                                </a>
                                                <button class="flex-1 block text-center px-4 py-2 bg-white/10 text-white font-semibold rounded-xl hover:bg-white/20 transition-all duration-300 text-sm flip-trigger">
                                                    Chi tiết
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flip-card-back glass-effect">
                                        <div class="flex-grow overflow-y-auto pr-2">
                                            ${summaryHtml}
                                        </div>
                                        <div class="flex gap-2 mt-4 pt-2 border-t border-white/20">
                                             <a href="${product.product_url}" target="_blank" class="flex-1 block text-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 font-semibold rounded-xl hover:shadow-lg transition-all text-sm text-white">
                                                Tới trang SP
                                            </a>
                                            <button class="flex-1 text-white/80 hover:text-white transition-colors flip-trigger-back bg-white/10 rounded-xl py-2 text-sm font-semibold">
                                                Quay lại
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            };
            
            // Compare functionality
            let compareList = [];
            const compareBtn = document.getElementById('compare-btn');
            const compareCount = document.getElementById('compare-count');
            const compareDropdown = document.getElementById('compare-dropdown');
            
            function updateCompareButton() {
                if (compareList.length > 0) {
                    compareBtn.disabled = false;
                    compareBtn.classList.remove('opacity-50');
                    compareBtn.classList.add('opacity-100');
                } else {
                    compareBtn.disabled = true;
                    compareBtn.classList.add('opacity-50');
                    compareBtn.classList.remove('opacity-100');
                }
                compareCount.textContent = compareList.length;
            }
            
            compareBtn?.addEventListener('click', function() {
                if (compareList.length > 0) {
                    compareDropdown.classList.toggle('hidden');
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!compareBtn?.contains(e.target)) {
                    compareDropdown?.classList.add('hidden');
                }
            });
            
            // Compare dropdown handlers
            document.querySelectorAll('[data-compare-type]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const type = this.dataset.compareType;
                    if (compareList.length >= 2) {
                        showComparisonModal(type);
                        compareDropdown.classList.add('hidden');
                    }
                });
            });

            app.init();
        });
    </script>
</body>
</html>